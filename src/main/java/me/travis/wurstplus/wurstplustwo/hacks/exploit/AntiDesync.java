package me.travis.wurstplus.wurstplustwo.hacks.exploit;

import java.util.Iterator;

import me.travis.wurstplus.wurstplustwo.event.WurstplusEventBus;
import me.travis.wurstplus.wurstplustwo.event.events.WurstplusEventPacket;
import me.travis.wurstplus.wurstplustwo.hacks.WurstplusCategory;
import me.travis.wurstplus.wurstplustwo.hacks.WurstplusHack;
import me.zero.alpine.fork.listener.EventHandler;
import me.zero.alpine.fork.listener.Listener;
import net.minecraft.entity.Entity;
import net.minecraft.entity.item.EntityEnderCrystal;
import net.minecraft.init.SoundEvents;
import net.minecraft.network.play.server.SPacketSoundEffect;
import net.minecraft.util.SoundCategory;
import net.minecraftforge.fml.common.eventhandler.SubscribeEvent;

public class AntiDesync extends WurstplusHack {
    public AntiDesync() {
        super(WurstplusCategory.WURSTPLUS_EXPLOIT);
        this.name = "Anti Desync";
        this.tag = "AntiDesync";
        this.description = "no desync";
    }

    @EventHandler
    private final Listener<WurstplusEventPacket.ReceivePacket> receive_listener = new Listener<WurstplusEventPacket.ReceivePacket>(event -> {
        if (event.get_packet() instanceof SPacketSoundEffect) {
            SPacketSoundEffect packet = (SPacketSoundEffect)event.get_packet();
            if (packet.getCategory() == SoundCategory.BLOCKS && packet.getSound() == SoundEvents.ENTITY_GENERIC_EXPLODE) {
                try {
                    Iterator var3 = mc.world.loadedEntityList.iterator();

                    while(var3.hasNext()) {
                        Entity e = (Entity)var3.next();
                        if (e instanceof EntityEnderCrystal && e.getDistance(packet.getX(), packet.getY(), packet.getZ()) <= 6.0D) {
                            e.setDead();
                        }
                    }
                } catch (Exception var5) {
                    var5.printStackTrace();
                }
            }
        }

    });


    @Override
    public void enable(){
        WurstplusEventBus.EVENT_BUS.subscribe(this);
    }

    @Override
    public void disable(){
        WurstplusEventBus.EVENT_BUS.unsubscribe(this);
    }
}
